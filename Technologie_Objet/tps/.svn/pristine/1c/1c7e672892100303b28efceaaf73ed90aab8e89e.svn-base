package allumettes;
import java.util.Scanner;

/** Fait respecter les règles du jeu aux deux joueurs.
 * 
 * @author ncazes2
 *
 */
public class Arbitre {
	
	private Joueur j1;
	private Joueur j2;
	private boolean confiant; // si confiant, l'arbitre transmet tout le jeu au joueur
	                          // sinon, il passe par la procuration
	
	public Arbitre(Joueur j1, Joueur j2, boolean confiant) {
		this.j1 = j1;
		this.j2 = j2;
		this.confiant = confiant;
		
	}
	
	/** Obtenir le joueur 1.
	 * @return j1 le joueur 1
	 */
	
	public Joueur getJ1(){
		return this.j1;
	}
	
	/** Obtenir le joueur 2.
	 * @return j2 le joueur 2
	 */
	
	public Joueur getJ2(){
		return this.j2;
	}
	
	/** Modifier le joueur 1.
	 * @param j1 le joueur 1
	 */
	public void setJ1(Joueur j1){
		this.j1 = j1;
	}
	
	/** Modifier le joueur 2.
	 * @param j2 le joueur 2
	 */
	public void setJ2(Joueur j2){
		this.j2 = j2;
	}
	
	/** Déterminer qui est le gagnant et qui est le perdant
	 *  lorsque le jeu est terminé. 
	 * @param jeu le jeu dans lequel on est
	 * @param cpt le compteur de nombre de tours du jeu
	 */
	public void afficherGagnantPerdant(Jeu jeu, int cpt) {
		
		// Si le jeu est terminé
		if (jeu.getNombreAllumettes() == 0) {
			
			// Le joueur 1 commence toujours en premier 
			if (cpt % 2 == 1) { // Si cpt % 2 == 1 c'est le joueur 1
				System.out.println(j2.getNom() + " a perdu !");
				System.out.println(j1.getNom() + " a gagné !");
			} else { // Si cpt % 2 == 0 c'est le joueur 2
				System.out.println(j1.getNom() + " a perdu !");
				System.out.println(j2.getNom() + " a gagné !");
			}
		}
	}
	
	/** Faire jouer un joueur.
	 * @param j le joueur à faire jouer
	 * @param jeu le jeu dans lequel on est
	 * @param cpt le compteur de nombre de tours du jeu
	 * @return cpt le compteur de nombre de tours du jeu
	 */
	public int faireJouer(Joueur j, Jeu jeu, int cpt){
		System.out.println("Au tour de " + j.getNom() +".");
		int nbAllumettes = 0;
		try {
			if (confiant) { // Transmet le jeu 
				nbAllumettes = j.getPrise(jeu);
			} else { // Passe par la procuration
			    nbAllumettes = j.getPrise(new Procuration(jeu));
			}
			jeu.retirer(nbAllumettes);
			String result = ""; 
			System.out.println(j.getNom() + " prend " + nbAllumettes + (result = (nbAllumettes == 1) ? " allumette." : " allumettes."));
		} catch(CoupInvalideException e) {
			
//			  if (j.getStrategie() instanceof StrategieHumaine) {
//			  System.out.println(j.getStrategie().scanner.nextLine()); 
//			}
			String result = "";
			System.out.println(j.getNom() + " prend " + e.getNombreAllumettes() + (result = (nbAllumettes == 1) ? " allumette." : " allumettes."));
			System.out.println(e.getMessage());
			System.out.println("Recommencez !\n");
        } catch(OperationInterditeException e1) {
        	System.out.println("Partie abandonnée car " + j.getNom() + " a triché !");
        } finally {
        	cpt = cpt + 1;
        	return cpt;
        }
	}
	
	/** Arbitrer une partie.
	 * @param jeu le jeu dans lequel on est
	 */
	public void arbitrer(Jeu jeu) {
		System.out.println("Nombre d'allumettes restantes : " + jeu.getNombreAllumettes());
		// On commence la partie au tour 1
		int cpt = 1;
		while (jeu.getNombreAllumettes()!= 0) {
			if (cpt % 2 == 1) {
				// On fait jouer le joueur 1
				faireJouer(this.j1, jeu, cpt);
			} else {
				// On fait jouer le joueur 2
				faireJouer(this.j2, jeu, cpt);
			}
		}
		// La partie est finie
		// On affiche qui est le gagnant 
		// et qui est le perdant
		 afficherGagnantPerdant(jeu, cpt);
			
	}
	

}
