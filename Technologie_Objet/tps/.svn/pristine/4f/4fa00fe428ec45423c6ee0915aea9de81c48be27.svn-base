import javax.swing.*;
import java.awt.*;
import javax.swing.event.*;
import java.awt.event.*;
import java.util.*;

/** Programmation d'un jeu de Morpion avec une interface graphique Swing.
  *
  * REMARQUE : Dans cette solution, le patron MVC n'a pas √©t√© appliqu√© !
  * On a un mod√®le (?), une vue et un contr√¥leur qui sont fortement li√©s.
  *
  * @author	Xavier Cr√©gut
  * @version	$Revision: 1.4 $
  */

public class MorpionSwing {

	// les images √† utiliser en fonction de l'√©tat du jeu.
	private static final Map<ModeleMorpion.Etat, ImageIcon> images
		= new HashMap<ModeleMorpion.Etat, ImageIcon>();
	static {
		images.put(ModeleMorpion.Etat.VIDE, new ImageIcon("blanc.jpg"));
		images.put(ModeleMorpion.Etat.CROIX, new ImageIcon("croix.jpg"));
		images.put(ModeleMorpion.Etat.ROND, new ImageIcon("rond.jpg"));
	}

// Choix de r√©alisation :
// ----------------------
//
//  Les attributs correspondant √† la structure fixe de l'IHM sont d√©finis
//	¬´ final static ¬ª pour montrer que leur valeur ne pourra pas changer au
//	cours de l'ex√©cution.  Ils sont donc initialis√©s sans attendre
//  l'ex√©cution du constructeur !

	private ModeleMorpion modele;	// le mod√®le du jeu de Morpion

//  Les √©l√©ments de la vue (IHM)
//  ----------------------------

	/** Fen√™tre principale */
	private JFrame fenetre;

	/** Bouton pour quitter */
	private final JButton boutonQuitter = new JButton("Q");

	/** Bouton pour commencer une nouvelle partie */
	private final JButton boutonNouvellePartie = new JButton("N");

	/** Cases du jeu */
	private final JLabel[][] cases = new JLabel[3][3];

	/** Zone qui indique le joueur qui doit jouer */
	private final JLabel joueur = new JLabel();
	
	/** Petit menu */
	private final JMenuBar menuBar = new JMenuBar();


// Le constructeur
// ---------------

	/** Construire le jeu de morpion */
	public MorpionSwing() {
		this(new ModeleMorpionSimple());
	}

	/** Construire le jeu de morpion */
	public MorpionSwing(ModeleMorpion modele) {
		// Initialiser le mod√®le
		this.modele = modele;

		// Cr√©er les cases du Morpion
		for (int i = 0; i < this.cases.length; i++) {
			for (int j = 0; j < this.cases[i].length; j++) {
				this.cases[i][j] = new JLabel();
			}
		}

		// Initialiser le jeu
		this.recommencer();
		

		// Construire la vue (pr√©sentation)
		//	D√©finir la fen√™tre principale
		this.fenetre = new JFrame("Morpion");
		this.fenetre.setLocation(100, 200); // emplacement de la fenÍtre
		
		java.awt.Container contenu = this.fenetre.getContentPane(); // contenu de la fen√™tre principale
		contenu.setLayout(new GridLayout(4,3));
		
		// D√©finir la position des 9 JLabel des cases
		for (int i = 0; i < this.cases.length; i++) {
			for (int j = 0; j < this.cases[i].length; j++) {
				contenu.add(this.cases[i][j]);
			}
		}
		
		// Cr√©tion du petit menu
		JMenu menu = new JMenu("Jeu");
		this.menuBar.add(menu);
		
		JMenuItem itemNouvellePartie = new JMenuItem("Nouvelle partie");
		itemNouvellePartie.addActionListener(new ActionNouvellePartie(this));
	    menu.add(itemNouvellePartie);
	    
	    JMenuItem itemQuitter = new JMenuItem("Quitter");
	    itemQuitter.addActionListener(new ActionQuitter());
	    menu.add(itemQuitter);
	    
	    fenetre.setJMenuBar(this.menuBar);
		
		// Placer les JButton des boutons NouvellePartie et Quitter
		contenu.add(boutonNouvellePartie);
		contenu.add(joueur);
		contenu.add(boutonQuitter);
		

		// Construire le contr√¥leur (gestion des √©v√©nements)
		this.fenetre.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
		
		boutonNouvellePartie.addActionListener(new ActionNouvellePartie(this));
		boutonQuitter.addActionListener(new ActionQuitter());
		
		for (int i = 0; i < this.cases.length; i++) {
			for (int j = 0; j < this.cases[i].length; j++) {
			    cliquerCase clique = new cliquerCase(this, i, j);
				this.cases[i][j].addMouseListener(clique);

			}
			
		}

		// afficher la fen√™tre
		this.fenetre.pack();			// redimmensionner la fen√™tre
		this.fenetre.setVisible(true);	// l'afficher
	}
// Les getters utiles
		
		/** Obtenir le JLabel correspondant au joueur.
		 * 
		 * @return joueur le JLabel correspondant au joueur
		 */
		public JLabel getJoueur() {
			return this.joueur;
			
		}
		
		/** Obtenir les cases.
		 * @return cases les cases du jeu
		 */
		public JLabel[][] getCases() {
			return this.cases;
		}
		
		/** Obtenir images.
		 * @return images 
		 */
		public Map<ModeleMorpion.Etat, ImageIcon> getImages() {
			return this.images;
		}
		
		/** Obtenir le modËle.
		 * @return modele le modËle
		 */
		public ModeleMorpion getModele() {
			return this.modele; 
		}
// Quelques r√©actions aux interactions de l'utilisateur
// ----------------------------------------------------

	/** Recommencer une nouvelle partie. */
	public void recommencer() {
		this.modele.recommencer();

		// Vider les cases
		for (int k = 0; k < this.cases.length; k++) {
			for (int l = 0; l < this.cases[k].length; l++) {
				this.cases[k][l].setIcon(images.get(this.modele.getValeur(k, l)));
			}
		}

		// Mettre √† jour le joueur
		joueur.setIcon(images.get(modele.getJoueur()));
	}


// La m√©thode principale
// ---------------------

	public static void main(String[] args) {
		EventQueue.invokeLater(new Runnable() {
			public void run() {
				new MorpionSwing();
			}
		});
	}

}
